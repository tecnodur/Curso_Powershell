<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/Curso_Powershell/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/Curso_Powershell/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li > a, .site-nav > ul.nav-list:first-child > li > ul > li:not(:nth-child(1)) > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(4) > ul > li:nth-child(1) > a { font-weight: 600; text-decoration: none; }.site-nav > ul.nav-list:first-child > li:nth-child(4) > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(4) > ul > li:nth-child(1) > button svg { transform: rotate(-90deg); }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(4) > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(4) > ul.nav-list > li.nav-list-item:nth-child(1) > ul.nav-list { display: block; } </style> <script src="/Curso_Powershell/assets/js/vendor/lunr.min.js"></script> <script src="/Curso_Powershell/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Session 1: Scripts, Segurança, Funções e Personalização | PowerShell Workshop</title> <meta name="generator" content="Jekyll v4.3.4" /> <meta property="og:title" content="Session 1: Scripts, Segurança, Funções e Personalização" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="A project site with collapsible side navigation." /> <meta property="og:description" content="A project site with collapsible side navigation." /> <link rel="canonical" href="https://tecnodur.github.io/Curso_Powershell/Modules/Module3/session1.html" /> <meta property="og:url" content="https://tecnodur.github.io/Curso_Powershell/Modules/Module3/session1.html" /> <meta property="og:site_name" content="PowerShell Workshop" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Session 1: Scripts, Segurança, Funções e Personalização" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"A project site with collapsible side navigation.","headline":"Session 1: Scripts, Segurança, Funções e Personalização","url":"https://tecnodur.github.io/Curso_Powershell/Modules/Module3/session1.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/Curso_Powershell/" class="site-title lh-tight"> PowerShell Workshop </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/Curso_Powershell/" class="nav-list-link">Curso de PowerShell & Shell Scripting</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Módulo 1: Introdução ao PowerShell e Shell Scripting category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/Curso_Powershell/Modules/Module1/" class="nav-list-link">Módulo 1: Introdução ao PowerShell e Shell Scripting</a><ul class="nav-list"><li class="nav-list-item"><a href="/Curso_Powershell/Modules/Module1/session1.html" class="nav-list-link">Session 1: Conceitos Básicos e Configuração</a></li><li class="nav-list-item"><a href="/Curso_Powershell/Modules/Module1/session2.html" class="nav-list-link">Sessão 2: Comandos, Navegação e Ajuda</a></li><li class="nav-list-item"><a href="/Curso_Powershell/Modules/Module1/session3.html" class="nav-list-link">Session 3: Objetos, parâmetros, pipeline, output, exportações</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Módulo 2: Fundamentos de Scripting e Lógica em PowerShell category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/Curso_Powershell/Modules/Module2/" class="nav-list-link">Módulo 2: Fundamentos de Scripting e Lógica em PowerShell</a><ul class="nav-list"><li class="nav-list-item"><a href="/Curso_Powershell/Modules/Module2/session1.html" class="nav-list-link">Session 1: Criar e Executar Scripts</a></li><li class="nav-list-item"><a href="/Curso_Powershell/Modules/Module2/session2.html" class="nav-list-link">Session 2: Variáveis e Tipos de Dados</a></li><li class="nav-list-item"><a href="/Curso_Powershell/Modules/Module2/session3.html" class="nav-list-link">Session 3: Tratamento de Erros com try, catch e finally</a></li><li class="nav-list-item"><a href="/Curso_Powershell/Modules/Module2/session4.html" class="nav-list-link">Session 4: Manipulação de Texto e Dados Simples</a></li><li class="nav-list-item"><a href="/Curso_Powershell/Modules/Module2/session5.html" class="nav-list-link">Session 5: Estruturas Condicionais</a></li><li class="nav-list-item"><a href="/Curso_Powershell/Modules/Module2/session6.html" class="nav-list-link">Session 6: Loops e Iterações</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Módulo 3: Gestão de Ficheiros e Processos category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/Curso_Powershell/Modules/Module3/" class="nav-list-link">Módulo 3: Gestão de Ficheiros e Processos</a><ul class="nav-list"><li class="nav-list-item"><a href="/Curso_Powershell/Modules/Module3/session1.html" class="nav-list-link">Session 1: Scripts, Segurança, Funções e Personalização</a></li><li class="nav-list-item"><a href="/Curso_Powershell/Modules/Module3/session2.html" class="nav-list-link">Session 2: Manipulação e Transformação de Coleções</a></li><li class="nav-list-item"><a href="/Curso_Powershell/Modules/Module3/session3.html" class="nav-list-link">Session 3: Personalização do Ambiente PowerShell</a></li><li class="nav-list-item"><a href="/Curso_Powershell/Modules/Module3/session4.html" class="nav-list-link">Session 4: Scripts Temáticos com Ficheiros</a></li><li class="nav-list-item"><a href="/Curso_Powershell/Modules/Module3/session5.html" class="nav-list-link">Session 5: Pesquisa, Filtragem e Exportação</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Módulo 4: Integração Avançada, Automatização e Ecossistemas category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/Curso_Powershell/Modules/Module4/" class="nav-list-link">Módulo 4: Integração Avançada, Automatização e Ecossistemas</a><ul class="nav-list"><li class="nav-list-item"><a href="/Curso_Powershell/Modules/Module4/session1.html" class="nav-list-link">Session 1: PowerShell em Linux com WSL</a></li><li class="nav-list-item"><a href="/Curso_Powershell/Modules/Module4/session2.html" class="nav-list-link">Session 2: PowerShell vs CMD: Diferenças e Utilização no Windows</a></li><li class="nav-list-item"><a href="/Curso_Powershell/Modules/Module4/session3.html" class="nav-list-link">Session 3: Tarefas Agendadas e Cron Jobs</a></li><li class="nav-list-item"><a href="/Curso_Powershell/Modules/Module4/session4.html" class="nav-list-link">Session 4: Serviços, Logs e Alertas</a></li><li class="nav-list-item"><a href="/Curso_Powershell/Modules/Module4/session5.html" class="nav-list-link">Session 5: Notificações e Relatórios Automatizados</a></li></ul></li><li class="nav-list-item"><a href="/Curso_Powershell/refRapida.html" class="nav-list-link">Referência Rápida</a></li><li class="nav-list-item"><a href="/Curso_Powershell/vscode.html" class="nav-list-link">Visual Studio Code com PowerShell</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search PowerShell Workshop" aria-label="Search PowerShell Workshop" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/Curso_Powershell/Modules/Module3/">Módulo 3: Gestão de Ficheiros e Processos</a></li> <li class="breadcrumb-nav-list-item"><span>Session 1: Scripts, Segurança, Funções e Personalização</span></li> </ol> </nav> <div id="main-content" class="main-content"> <main> <h2 style="all: unset; font-size: 5em; font-weight: bold;"> 🧭 Sessão 1: Scripts, Segurança, Funções e Personalização </h2> <p><br /></p> <p><strong>🎯 Objetivo</strong> Consolidar práticas seguras e profissionais na criação de scripts PowerShell, introduzir o conceito de funções reutilizáveis, reforçar a recolha e validação de inputs, e personalizar o ambiente PowerShell para desenvolvimento.</p><hr /> <ul> <li><a href="#1-relembrar-execução-de-scripts-e-caminhos">1. Relembrar: Execução de Scripts e Caminhos</a> <ul> <li><a href="#11-executar-scripts-ps1">1.1. Executar scripts <code class="language-plaintext highlighter-rouge">.ps1</code></a></li> <li><a href="#12-caminhos-absolutos-vs-caminhos-relativos">1.2. Caminhos absolutos vs caminhos relativos</a></li> <li><a href="#13-usar-psscriptroot--join-path">1.3. Usar <code class="language-plaintext highlighter-rouge">$PSScriptRoot</code> + <code class="language-plaintext highlighter-rouge">Join-Path</code></a></li> </ul> </li> <li><a href="#2-segurança-e-boas-práticas-ao-trabalhar-com-scripts">2. Segurança e Boas Práticas ao Trabalhar com Scripts</a> <ul> <li><a href="#21-scripts-de-fontes-desconhecidas">2.1. Scripts de fontes desconhecidas</a></li> <li><a href="#22-boas-práticas-ao-correr-scripts-externos">2.2. Boas práticas ao correr scripts externos</a></li> <li><a href="#23-lógica-de-confirmação-antes-de-ações-sensíveis">2.3. Lógica de confirmação antes de ações sensíveis</a></li> <li><a href="#24-registo-e-controlo-logging-básico">2.4. Registo e controlo (logging básico)</a></li> <li><a href="#25-exemplo-uso-simples-de-write-verbose">2.5. Exemplo: Uso simples de <code class="language-plaintext highlighter-rouge">Write-Verbose</code></a></li> <li><a href="#26-dica-adicional">2.6. Dica adicional</a></li> <li><a href="#27-tipos-de-mensagens-no-terminal-canais-de-escrita">2.7. Tipos de mensagens no terminal (canais de escrita)</a></li> </ul> </li> <li><a href="#3-criar-logs-em-powershell">3. Criar Logs em PowerShell</a> <ul> <li><a href="#31-o-que-colocar-nos-logs">3.1. O que colocar nos logs?</a></li> <li><a href="#32-formatos-de-data-úteis">3.2. Formatos de data úteis</a></li> <li><a href="#33-iniciar-um-log-com-informações-básicas">3.3. Iniciar um log com informações básicas</a></li> <li><a href="#34-exemplo-de-entradas-de-log-com-tags">3.4. Exemplo de entradas de log com tags</a></li> <li><a href="#35-criar-ficheiro-de-log-único-por-execução">3.5. Criar ficheiro de log único por execução</a></li> <li><a href="#36-fechar-o-log-com-mensagem-de-fim">3.6. Fechar o log com mensagem de fim</a></li> <li><a href="#37-exemplo-completo-script-que-apaga-um-ficheiro-com-logging-e-confirmação">3.7. Exemplo completo: script que apaga um ficheiro com logging e confirmação</a></li> <li><a href="#38--exercício-copiar-ficheiro-com-logging-personalizado">3.8. 🧩 Exercício: copiar ficheiro com logging personalizado</a></li> </ul> </li> <li><a href="#4-funções-em-powershell">4. Funções em PowerShell</a> <ul> <li><a href="#41-o-que-é-uma-função">4.1. O que é uma função?</a></li> <li><a href="#42-funções-com-parâmetros">4.2. Funções com parâmetros</a></li> <li><a href="#43-tipagem-de-parâmetros-opcional">4.3. Tipagem de parâmetros (opcional)</a></li> <li><a href="#44-funções-para-modularizar-scripts">4.4. Funções para modularizar scripts</a></li> <li><a href="#45-usar-return-para-devolver-valores">4.5. Usar <code class="language-plaintext highlighter-rouge">return</code> para devolver valores</a></li> <li><a href="#46-boas-práticas-ao-criar-funções">4.6. Boas práticas ao criar funções</a></li> <li><a href="#47-verbos-aprovados-pelo-powershell">4.7. Verbos aprovados pelo PowerShell</a></li> <li><a href="#48--exercícios-com-funções">4.8. 🧩 Exercícios com funções</a></li> </ul> </li> <li><a href="#5-recolha-de-inputs-do-utilizador">5. Recolha de Inputs do Utilizador</a> <ul> <li><a href="#51-recolher-input-com-read-host">5.1. Recolher input com <code class="language-plaintext highlighter-rouge">Read-Host</code></a></li> <li><a href="#52-converter-e-validar-o-input">5.2. Converter e validar o input</a></li> <li><a href="#53-confirmar-ações-com-input">5.3. Confirmar ações com input</a></li> <li><a href="#54-input-com-janela-gráfica">5.4. Input com janela gráfica</a></li> <li><a href="#55-sanitização-e-boas-práticas">5.5. Sanitização e boas práticas</a></li> <li><a href="#56-exemplo-sem-sanitização-vs-com-sanitização-simples-e-seguro">5.6. Exemplo: sem sanitização vs com sanitização (simples e seguro)</a></li> <li><a href="#57--exercícios-sobre-input">5.7. 🧩 Exercícios sobre Input</a></li> </ul> </li> </ul><hr /> <h2 id="1-relembrar-execução-de-scripts-e-caminhos"> <a href="#1-relembrar-execução-de-scripts-e-caminhos" class="anchor-heading" aria-labelledby="1-relembrar-execução-de-scripts-e-caminhos"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. Relembrar: Execução de Scripts e Caminhos </h2> <p>Nesta secção vamos relembrar rapidamente como funcionam os scripts PowerShell (<code class="language-plaintext highlighter-rouge">.ps1</code>), a importância de usar caminhos corretos e como garantir que os scripts são portáteis e seguros.</p> <h3 id="11-executar-scripts-ps1"> <a href="#11-executar-scripts-ps1" class="anchor-heading" aria-labelledby="11-executar-scripts-ps1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1.1. Executar scripts <code class="language-plaintext highlighter-rouge">.ps1</code> </h3> <p>Um script PowerShell é um ficheiro de texto com a extensão <code class="language-plaintext highlighter-rouge">.ps1</code> que contém uma sequência de comandos.</p> <p>Se o script estiver na mesma pasta onde o terminal está aberto:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.\script.ps1
</code></pre></div></div> <p>Se estiver noutra pasta:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Utilizadores\Nuno\Documentos\script.ps1
</code></pre></div></div> <blockquote> <p>🔗 Já vimos a execução de scripts e permissões na <a href="../Module2/session1">Sessão 1 do Módulo 2</a></p> </blockquote> <h3 id="12-caminhos-absolutos-vs-caminhos-relativos"> <a href="#12-caminhos-absolutos-vs-caminhos-relativos" class="anchor-heading" aria-labelledby="12-caminhos-absolutos-vs-caminhos-relativos"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1.2. Caminhos absolutos vs caminhos relativos </h3> <p>Evita usar caminhos absolutos nos scripts:</p> <p>✖ <code class="language-plaintext highlighter-rouge">$ficheiro = "C:\dados\ficheiro.txt"</code></p> <p>Prefere caminhos relativos:</p> <p>✔ <code class="language-plaintext highlighter-rouge">$ficheiro = ".\dados\ficheiro.txt"</code></p> <p><u>Mas atenção</u>: esse caminho é <strong>relativo ao terminal</strong>, não ao local onde o script está guardado.</p> <h3 id="13-usar-psscriptroot--join-path"> <a href="#13-usar-psscriptroot--join-path" class="anchor-heading" aria-labelledby="13-usar-psscriptroot--join-path"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1.3. Usar <code class="language-plaintext highlighter-rouge">$PSScriptRoot</code> + <code class="language-plaintext highlighter-rouge">Join-Path</code> </h3> <p>Para garantir que o caminho é relativo ao <strong>script</strong>, usa a variável automática <code class="language-plaintext highlighter-rouge">$PSScriptRoot</code>:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ficheiro = Join-Path $PSScriptRoot "dados\ficheiro.txt"
</code></pre></div></div> <p>Este método torna o script mais robusto e portátil.</p> <p>Exemplo completo:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ficheiro = Join-Path $PSScriptRoot "dados\frases.txt"
$linhas = Get-Content $ficheiro
Write-Output "Conteúdo lido:"
$linhas
</code></pre></div></div> <blockquote> <p>🔗 Esta técnica foi aplicada com mais detalhe na <a href="../Module2/session1#16-boas-práticas-iniciais-com-scripts">Sessão 1 do Módulo 2</a></p> </blockquote><hr /> <h2 id="2-segurança-e-boas-práticas-ao-trabalhar-com-scripts"> <a href="#2-segurança-e-boas-práticas-ao-trabalhar-com-scripts" class="anchor-heading" aria-labelledby="2-segurança-e-boas-práticas-ao-trabalhar-com-scripts"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2. Segurança e Boas Práticas ao Trabalhar com Scripts </h2> <p>Nesta fase do curso, é importante adotar hábitos seguros ao desenvolver, testar e partilhar scripts PowerShell. Mesmo em ambientes internos, práticas inseguras podem causar perda de dados ou comprometer sistemas.</p> <h3 id="21-scripts-de-fontes-desconhecidas"> <a href="#21-scripts-de-fontes-desconhecidas" class="anchor-heading" aria-labelledby="21-scripts-de-fontes-desconhecidas"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2.1. Scripts de fontes desconhecidas </h3> <p>Sempre que receberes um script <code class="language-plaintext highlighter-rouge">.ps1</code> de outra pessoa ou da internet:</p> <ul> <li><strong>Não corras diretamente</strong>. Abre o ficheiro num editor e lê o conteúdo.</li> <li>Verifica se existem comandos perigosos como <code class="language-plaintext highlighter-rouge">Remove-Item</code>, <code class="language-plaintext highlighter-rouge">Stop-Service</code>, <code class="language-plaintext highlighter-rouge">Invoke-WebRequest</code>, <code class="language-plaintext highlighter-rouge">Start-Process</code> com privilégios.</li> <li>Se estiver ofuscado (código difícil de ler de propósito), não o uses.</li> </ul> <h3 id="22-boas-práticas-ao-correr-scripts-externos"> <a href="#22-boas-práticas-ao-correr-scripts-externos" class="anchor-heading" aria-labelledby="22-boas-práticas-ao-correr-scripts-externos"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2.2. Boas práticas ao correr scripts externos </h3> <ul> <li>Rever manualmente o conteúdo</li> <li>Executar em ambiente de testes sempre que possível</li> <li>Se tiveres dúvidas, pergunta ou executa num PowerShell isolado (Windows Sandbox, por exemplo)</li> <li> <p>Se o ficheiro veio da internet, pode ser necessário usar:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  Unblock-File -Path ".\nome-do-script.ps1"
</code></pre></div> </div> </li> </ul> <h4 id="nota-como-testar-scripts-em-segurança"> <a href="#nota-como-testar-scripts-em-segurança" class="anchor-heading" aria-labelledby="nota-como-testar-scripts-em-segurança"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Nota: Como testar scripts em segurança </h4> <p>Executar scripts num ambiente de testes é uma das melhores formas de evitar danos acidentais, especialmente quando os scripts fazem alterações no sistema, nos ficheiros ou nos serviços.</p> <p><strong>Como criar um ambiente de testes simples em casa</strong></p> <ul> <li>Cria uma <strong>máquina virtual</strong> com Windows (pode ser com o VirtualBox ou Hyper-V)</li> <li>Instala o PowerShell e edita os teus scripts à vontade</li> <li>Alternativa mais simples: usa o <strong>Windows Sandbox</strong> se tiveres o Windows 10/11 Pro</li> </ul> <blockquote> <p>O <strong>Windows Sandbox</strong> é um Windows temporário e isolado. Tudo o que fizeres lá é apagado ao fechar.<br /> Basta ativar nas funcionalidades do Windows e abrir pelo menu iniciar.</p> </blockquote> <p><strong>Ambientes de testes em contexto empresarial</strong></p> <ul> <li>Muitas empresas usam <strong>ambientes de testes (test/dev)</strong> separados dos sistemas reais (prod)</li> <li>Se estiveres num ambiente empresarial: <ul> <li>Pergunta se existe uma máquina virtual ou ambiente “sandbox” para testes</li> <li>Nunca corras scripts diretamente em servidores de produção sem validação</li> </ul> </li> </ul> <h3 id="23-lógica-de-confirmação-antes-de-ações-sensíveis"> <a href="#23-lógica-de-confirmação-antes-de-ações-sensíveis" class="anchor-heading" aria-labelledby="23-lógica-de-confirmação-antes-de-ações-sensíveis"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2.3. Lógica de confirmação antes de ações sensíveis </h3> <p>Se o teu script pode modificar ou eliminar algo, adiciona confirmações explícitas para evitar erros acidentais.</p> <p>Exemplo:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$confirmar = Read-Host "Este script vai apagar ficheiros. Continuar? (S/N)"
if ($confirmar -ne "N") {
    Write-Output "Operação cancelada."
    exit
}
</code></pre></div></div> <p>Outros exemplos:</p> <ul> <li>Confirmar antes de correr <code class="language-plaintext highlighter-rouge">Remove-Item</code>, <code class="language-plaintext highlighter-rouge">Stop-Process</code>, <code class="language-plaintext highlighter-rouge">Restart-Service</code></li> <li>Verificar se ficheiros existem antes de os apagar</li> </ul> <h3 id="24-registo-e-controlo-logging-básico"> <a href="#24-registo-e-controlo-logging-básico" class="anchor-heading" aria-labelledby="24-registo-e-controlo-logging-básico"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2.4. Registo e controlo (logging básico) </h3> <p>Para facilitar auditoria ou debugging, regista o que o script fez:</p> <ol> <li> <p><strong>Escrever no terminal:</strong> útil para feedback visual imediato</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> Write-Output "Apagar ficheiro $ficheiro..."
</code></pre></div> </div> </li> <li> <p><strong>Gravar em ficheiro de log:</strong> ideal para manter registo do que foi feito</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> Add-Content -Path ".\log.txt" -Value "[$(Get-Date -Format "yyyy-MM-dd HH:mm")] Ficheiro removido: $ficheiro"
</code></pre></div> </div> </li> <li> <p><strong>Escrever mensagens detalhadas (avançado):</strong> útil para scripts com modo “verbose”</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> Write-Verbose "O ficheiro $ficheiro foi apagado com sucesso."
</code></pre></div> </div> </li> </ol> <blockquote> <p>Para que as mensagens <code class="language-plaintext highlighter-rouge">Write-Verbose</code> apareçam, o script deve ser executado com o parâmetro <code class="language-plaintext highlighter-rouge">-Verbose</code> e conter <code class="language-plaintext highlighter-rouge">[CmdletBinding()]</code> no topo, se for uma função ou script avançado.</p> </blockquote> <h3 id="25-exemplo-uso-simples-de-write-verbose"> <a href="#25-exemplo-uso-simples-de-write-verbose" class="anchor-heading" aria-labelledby="25-exemplo-uso-simples-de-write-verbose"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2.5. Exemplo: Uso simples de <code class="language-plaintext highlighter-rouge">Write-Verbose</code> </h3> <p>O <code class="language-plaintext highlighter-rouge">Write-Verbose</code> permite mostrar mensagens detalhadas apenas quando o script é executado com o parâmetro <code class="language-plaintext highlighter-rouge">-Verbose</code>.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[CmdletBinding()]
param()

Write-Output "Início do script"

Write-Verbose "Esta é uma mensagem de debug detalhada"

Write-Output "Fim do script"
</code></pre></div></div> <p>Ao correr o script normalmente: <code class="language-plaintext highlighter-rouge">.\meu-script.ps1</code> → só aparecem as mensagens Write-Output</p> <p>Ao correr com -Verbose: <code class="language-plaintext highlighter-rouge">.\meu-script.ps1 -Verbose</code> → também aparece a linha Write-Verbose</p> <h3 id="26-dica-adicional"> <a href="#26-dica-adicional" class="anchor-heading" aria-labelledby="26-dica-adicional"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2.6. Dica adicional </h3> <ul> <li>Mesmo scripts pequenos devem seguir estas boas práticas. Com o tempo, é fácil esquecer o que um script faz — um bom log e mensagens claras fazem a diferença.</li> <li>Este tipo de proteção não é só para servidores — é também para ti, enquanto desenvolvedor.</li> </ul> <h3 id="27-tipos-de-mensagens-no-terminal-canais-de-escrita"> <a href="#27-tipos-de-mensagens-no-terminal-canais-de-escrita" class="anchor-heading" aria-labelledby="27-tipos-de-mensagens-no-terminal-canais-de-escrita"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2.7. Tipos de mensagens no terminal (canais de escrita) </h3> <p>Em PowerShell, existem vários comandos para enviar mensagens para o terminal — cada um com um objetivo específico.</p> <p>Alguns são visíveis por defeito, outros só aparecem quando são ativados com parâmetros como <code class="language-plaintext highlighter-rouge">-Verbose</code> ou <code class="language-plaintext highlighter-rouge">-Debug</code>.</p> <h4 id="-comandos-de-escrita-mais-comuns"> <a href="#-comandos-de-escrita-mais-comuns" class="anchor-heading" aria-labelledby="-comandos-de-escrita-mais-comuns"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 🧩 Comandos de escrita mais comuns </h4> <div class="table-wrapper"><table> <thead> <tr> <th>Comando</th> <th>Canal</th> <th>Visível por defeito?</th> <th>Utilização típica</th> </tr> </thead> <tbody> <tr> <td><code class="language-plaintext highlighter-rouge">Write-Output</code></td> <td>Output (stream 1)</td> <td>✅ Sim</td> <td>Devolver valores ou mensagens ao pipeline</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">Write-Host</code></td> <td>Host (direto)</td> <td>✅ Sim</td> <td>Mostrar mensagens diretamente no terminal</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">Write-Verbose</code></td> <td>Verbose (stream 4)</td> <td>❌ Só com <code class="language-plaintext highlighter-rouge">-Verbose</code></td> <td>Mensagens de depuração mais detalhadas</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">Write-Debug</code></td> <td>Debug (stream 5)</td> <td>❌ Só com <code class="language-plaintext highlighter-rouge">-Debug</code></td> <td>Mensagens passo a passo para troubleshooting</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">Write-Warning</code></td> <td>Warning (stream 3)</td> <td>✅ Sim</td> <td>Mostrar avisos (normalmente a amarelo)</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">Write-Error</code></td> <td>Error (stream 2)</td> <td>✅ Sim</td> <td>Mensagens de erro, visíveis e registadas em <code class="language-plaintext highlighter-rouge">$Error</code></td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">Write-Information</code></td> <td>Information (stream 6)</td> <td>❌ Só com <code class="language-plaintext highlighter-rouge">-InformationAction</code></td> <td>Mensagens informativas para logging ou debug</td> </tr> </tbody> </table></div><hr /> <h4 id="exemplos-rápidos"> <a href="#exemplos-rápidos" class="anchor-heading" aria-labelledby="exemplos-rápidos"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Exemplos rápidos </h4> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Write-Output "Isto é output normal"
Write-Host "Mensagem direta ao terminal"
Write-Verbose "Detalhes internos"         # Só com -Verbose
Write-Warning "Atenção: algo não está certo"
Write-Error "Erro grave"
Write-Debug "Valor da variável x = 5"     # Só com -Debug
Write-Information "Info extra"            # Requer -InformationAction Continue
</code></pre></div></div><hr /> <blockquote> <p>💡 Usa <code class="language-plaintext highlighter-rouge">Write-Output</code> para devolver valores, e <code class="language-plaintext highlighter-rouge">Write-Host</code> apenas para mensagens visuais.<br /> Para mensagens técnicas ou auxiliares, usa <code class="language-plaintext highlighter-rouge">Write-Verbose</code>, <code class="language-plaintext highlighter-rouge">Write-Warning</code> ou <code class="language-plaintext highlighter-rouge">Write-Information</code> conforme o objetivo.</p> </blockquote> <p><strong>O que são os <em>streams</em> (fluxos de saída)?</strong></p> <p>PowerShell usa diferentes “canais” para enviar informação para fora dos comandos. Cada canal é chamado de <strong>stream</strong> e tem um número associado:</p> <ul> <li><strong>1 – Output</strong>: valores normais devolvidos por comandos (<code class="language-plaintext highlighter-rouge">Write-Output</code>)</li> <li><strong>2 – Error</strong>: mensagens de erro (<code class="language-plaintext highlighter-rouge">Write-Error</code>)</li> <li><strong>3 – Warning</strong>: avisos (<code class="language-plaintext highlighter-rouge">Write-Warning</code>)</li> <li><strong>4 – Verbose</strong>: mensagens detalhadas de debug (<code class="language-plaintext highlighter-rouge">Write-Verbose</code>)</li> <li><strong>5 – Debug</strong>: mensagens passo a passo (<code class="language-plaintext highlighter-rouge">Write-Debug</code>)</li> <li><strong>6 – Information</strong>: mensagens informativas controláveis (<code class="language-plaintext highlighter-rouge">Write-Information</code>)</li> </ul> <p>Cada stream pode ser mostrado, redirecionado ou ignorado de forma independente.<br /> Isto permite separar resultados normais, erros, e mensagens auxiliares num script mais profissional.</p> <p><strong>Redirecionamento de Streams:</strong> É possível redirecionar os streams para ficheiros ou outros destinos. Por exemplo, para redirecionar erros para um ficheiro:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-Process -Name "ProcessoInexistente" 2&gt; erros.txt Para redirecionar todos os streams para um único ficheiro:

.\script.ps1 *&gt; saída_completa.txt O operador `*&gt;` redireciona todos os streams (1 a 6) para o destino especificado.
</code></pre></div></div> <p>Compreender e utilizar corretamente os streams permite um controlo mais preciso sobre a saída dos scripts e facilita a identificação e resolução de problemas.</p><hr /> <h2 id="3-criar-logs-em-powershell"> <a href="#3-criar-logs-em-powershell" class="anchor-heading" aria-labelledby="3-criar-logs-em-powershell"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3. Criar Logs em PowerShell </h2> <p>Criar logs é uma prática fundamental para saber o que os scripts fizeram, quando correram e quem os executou. Isto é essencial para análise, auditoria e resolução de problemas.</p> <h3 id="31-o-que-colocar-nos-logs"> <a href="#31-o-que-colocar-nos-logs" class="anchor-heading" aria-labelledby="31-o-que-colocar-nos-logs"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.1. O que colocar nos logs? </h3> <p>Um bom log deve incluir:</p> <ul> <li>Data e hora de cada evento</li> <li>Ação realizada e respetivo resultado</li> <li>Mensagens de erro claras</li> <li>Informação contextual: quem executou, onde e quando</li> <li>Separação por tipo: [INFO], [ERRO], [WARN], etc.</li> </ul> <h3 id="32-formatos-de-data-úteis"> <a href="#32-formatos-de-data-úteis" class="anchor-heading" aria-labelledby="32-formatos-de-data-úteis"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.2. Formatos de data úteis </h3> <p>Get-Date -Format “yyyy-MM-dd HH:mm” # legível Get-Date -Format “yyyyMMdd_HHmmss” # útil para nomes de ficheiro (Get-Date).ToString(“o”) # formato ISO 8601</p> <h3 id="33-iniciar-um-log-com-informações-básicas"> <a href="#33-iniciar-um-log-com-informações-básicas" class="anchor-heading" aria-labelledby="33-iniciar-um-log-com-informações-básicas"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.3. Iniciar um log com informações básicas </h3> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$logPath = ".\log.txt"
$data = Get-Date -Format "yyyy-MM-dd HH:mm"
$utilizador = $env:USERNAME
$maquina = $env:COMPUTERNAME
$pasta = Get-Location

Add-Content -Path $logPath -Value ""
Add-Content -Path $logPath -Value "$data [INFO] === Início do Script ==="
Add-Content -Path $logPath -Value "$data [INFO] Utilizador: $utilizador"
Add-Content -Path $logPath -Value "$data [INFO] Máquina: $maquina"
Add-Content -Path $logPath -Value "$data [INFO] Diretório atual: $pasta"
Add-Content -Path $logPath -Value "$data [INFO] =========================="
</code></pre></div></div> <h3 id="34-exemplo-de-entradas-de-log-com-tags"> <a href="#34-exemplo-de-entradas-de-log-com-tags" class="anchor-heading" aria-labelledby="34-exemplo-de-entradas-de-log-com-tags"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.4. Exemplo de entradas de log com tags </h3> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$acao = "Ficheiro apagado: exemplo.txt"
$data = Get-Date -Format "yyyy-MM-dd HH:mm"
Add-Content -Path $logPath -Value "$data [INFO] $acao"
</code></pre></div></div> <p><strong>Em caso de erro</strong></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$erro = "Falha ao apagar ficheiro: acesso negado"
Add-Content -Path $logPath -Value "$data [ERRO] $erro"
</code></pre></div></div> <p><strong>Aviso</strong></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Add-Content -Path $logPath -Value "$data [WARN] Nenhum ficheiro foi encontrado para apagar"
</code></pre></div></div> <h3 id="35-criar-ficheiro-de-log-único-por-execução"> <a href="#35-criar-ficheiro-de-log-único-por-execução" class="anchor-heading" aria-labelledby="35-criar-ficheiro-de-log-único-por-execução"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.5. Criar ficheiro de log único por execução </h3> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$timestamp = Get-Date -Format "yyyyMMdd_HHmmss"
$logPath = ".\log_$timestamp.txt"
</code></pre></div></div> <h3 id="36-fechar-o-log-com-mensagem-de-fim"> <a href="#36-fechar-o-log-com-mensagem-de-fim" class="anchor-heading" aria-labelledby="36-fechar-o-log-com-mensagem-de-fim"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.6. Fechar o log com mensagem de fim </h3> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$data = Get-Date -Format "yyyy-MM-dd HH:mm"
Add-Content -Path $logPath -Value "$data [INFO] Script terminado com sucesso"
</code></pre></div></div> <h3 id="37-exemplo-completo-script-que-apaga-um-ficheiro-com-logging-e-confirmação"> <a href="#37-exemplo-completo-script-que-apaga-um-ficheiro-com-logging-e-confirmação" class="anchor-heading" aria-labelledby="37-exemplo-completo-script-que-apaga-um-ficheiro-com-logging-e-confirmação"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.7. Exemplo completo: script que apaga um ficheiro com logging e confirmação </h3> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Criar nome único para o ficheiro de log
$timestamp = Get-Date -Format "yyyyMMdd_HHmmss"
$logPath = ".\log_$timestamp.txt"

# Cabeçalho com informações básicas
$data = Get-Date -Format "yyyy-MM-dd HH:mm"
$utilizador = $env:USERNAME
$maquina = $env:COMPUTERNAME
$pasta = Get-Location

Add-Content -Path $logPath -Value "$data [INFO] === Início do Script ==="
Add-Content -Path $logPath -Value "$data [INFO] Utilizador: $utilizador"
Add-Content -Path $logPath -Value "$data [INFO] Máquina: $maquina"
Add-Content -Path $logPath -Value "$data [INFO] Diretório atual: $pasta"

# Input do utilizador
$ficheiro = Read-Host "Introduz o caminho do ficheiro a apagar"

# Verificação se o ficheiro existe
if (-not (Test-Path $ficheiro)) {
    Write-Output "Ficheiro não encontrado."
    Add-Content -Path $logPath -Value "$data [ERRO] Ficheiro não encontrado: $ficheiro"
    return
}

# Confirmação antes de apagar
$confirmar = Read-Host "Tens a certeza que queres apagar este ficheiro? (S/N)"
if ($confirmar -ne "N") {
    Write-Output "Operação cancelada."
    Add-Content -Path $logPath -Value "$data [INFO] Operação cancelada pelo utilizador"
    return
}

# Apagar o ficheiro e registar no log
try {
    Remove-Item -Path $ficheiro -ErrorAction Stop
    Write-Output "Ficheiro apagado com sucesso."
    $data = Get-Date -Format "yyyy-MM-dd HH:mm"
    Add-Content -Path $logPath -Value "$data [INFO] Ficheiro apagado: $ficheiro"
}
catch {
    Write-Output "Erro ao apagar ficheiro: $_"
    $data = Get-Date -Format "yyyy-MM-dd HH:mm"
    Add-Content -Path $logPath -Value "$data [ERRO] Falha ao apagar ficheiro: $_"
}

# Fim do script
$data = Get-Date -Format "yyyy-MM-dd HH:mm"
Add-Content -Path $logPath -Value "$data [INFO] Script terminado"
</code></pre></div></div> <h3 id="38--exercício-copiar-ficheiro-com-logging-personalizado"> <a href="#38--exercício-copiar-ficheiro-com-logging-personalizado" class="anchor-heading" aria-labelledby="38--exercício-copiar-ficheiro-com-logging-personalizado"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.8. 🧩 Exercício: copiar ficheiro com logging personalizado </h3> <p>Pretende-se criar um script que copie um ficheiro de um local para outro.<br /> A cópia já está feita — o teu foco será <strong>criar entradas de log úteis, completas e bem estruturadas</strong>.</p> <h4 id="o-que-deves-implementar"> <a href="#o-que-deves-implementar" class="anchor-heading" aria-labelledby="o-que-deves-implementar"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> O que deves implementar: </h4> <ol> <li>Criar um ficheiro de log com nome baseado na data/hora</li> <li>Escrever um <strong>cabeçalho</strong> com: <ul> <li>Data de início do script</li> <li>Utilizador</li> <li>Nome da máquina</li> <li>Diretório atual</li> <li>Número de processos ativos (usa Get-Process)</li> </ul> </li> <li>Registar: <ul> <li>Se o ficheiro de origem existe ou não</li> <li>Ação de cópia (sucesso ou falha)</li> <li>Hora em que o script terminou</li> </ul> </li> <li>Utiliza <strong>tags</strong> como <code class="language-plaintext highlighter-rouge">[INFO]</code>, <code class="language-plaintext highlighter-rouge">[ERRO]</code>, <code class="language-plaintext highlighter-rouge">[WARN]</code> nas linhas do log</li> <li>Usa <code class="language-plaintext highlighter-rouge">Get-Date -Format "yyyy-MM-dd HH:mm"</code> para adicionar a data em cada linha</li> </ol><hr /> <h4 id="código-base-do-exercício"> <a href="#código-base-do-exercício" class="anchor-heading" aria-labelledby="código-base-do-exercício"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Código base do exercício </h4> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Caminho para o ficheiro de log (deves gerar um nome com timestamp)
$logPath = ""

# INPUTS do utilizador
$origem = Read-Host "Introduz o caminho do ficheiro de origem"
$destino = Read-Host "Introduz o caminho de destino (ficheiro ou pasta)"

# VERIFICAR se o ficheiro de origem existe
if (-not (Test-Path $origem)) {
    Write-Output "Ficheiro não encontrado: $origem"
    
    # TODO: Adicionar entrada ao log com [ERRO] e a mensagem do erro
    return
}

# COPIAR o ficheiro
try {
    Copy-Item -Path $origem -Destination $destino -Force
    Write-Output "Ficheiro copiado com sucesso."

    # TODO: Adicionar entrada ao log com [INFO] sobre o sucesso da cópia
}
catch {
    Write-Output "Erro ao copiar ficheiro: $_"

    # TODO: Adicionar entrada ao log com [ERRO] e o conteúdo da variável $_
}

# TODO: Escrever uma linha final no log com [INFO] indicando que o script terminou
</code></pre></div></div> <!-- <details markdown="1"> <summary>📌 Exemplo de solução</summary> # Criar nome de ficheiro de log com timestamp $timestamp = Get-Date -Format "yyyyMMdd_HHmmss" $logPath = ".\log_$timestamp.txt" # Cabeçalho do log $data = Get-Date -Format "yyyy-MM-dd HH:mm" $utilizador = $env:USERNAME $maquina = $env:COMPUTERNAME $pasta = Get-Location $proc = (Get-Process).Count Add-Content -Path $logPath -Value "$data [INFO] === Início do Script ===" Add-Content -Path $logPath -Value "$data [INFO] Utilizador: $utilizador" Add-Content -Path $logPath -Value "$data [INFO] Máquina: $maquina" Add-Content -Path $logPath -Value "$data [INFO] Diretório atual: $pasta" Add-Content -Path $logPath -Value "$data [INFO] Processos ativos: $proc" # INPUTS $origem = Read-Host "Introduz o caminho do ficheiro de origem" $destino = Read-Host "Introduz o caminho de destino (ficheiro ou pasta)" # Verificação if (-not (Test-Path $origem)) { Write-Output "Ficheiro não encontrado: $origem" $data = Get-Date -Format "yyyy-MM-dd HH:mm" Add-Content -Path $logPath -Value "$data [ERRO] Ficheiro não encontrado: $origem" return } # Cópia try { Copy-Item -Path $origem -Destination $destino -Force Write-Output "Ficheiro copiado com sucesso." $data = Get-Date -Format "yyyy-MM-dd HH:mm" Add-Content -Path $logPath -Value "$data [INFO] Ficheiro copiado de $origem para $destino" } catch { Write-Output "Erro ao copiar ficheiro: $_" $data = Get-Date -Format "yyyy-MM-dd HH:mm" Add-Content -Path $logPath -Value "$data [ERRO] Falha ao copiar: $_" } # Final do log $data = Get-Date -Format "yyyy-MM-dd HH:mm" Add-Content -Path $logPath -Value "$data [INFO] Script terminado" </details> --><hr /> <h2 id="4-funções-em-powershell"> <a href="#4-funções-em-powershell" class="anchor-heading" aria-labelledby="4-funções-em-powershell"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4. Funções em PowerShell </h2> <p>Funções são blocos de código reutilizáveis que permitem organizar scripts, evitar repetições e tornar o código mais limpo e fácil de manter.</p> <h3 id="41-o-que-é-uma-função"> <a href="#41-o-que-é-uma-função" class="anchor-heading" aria-labelledby="41-o-que-é-uma-função"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4.1. O que é uma função? </h3> <p>Uma função é um grupo de comandos que executam uma tarefa específica. Em PowerShell, definimos funções com a palavra-chave <code class="language-plaintext highlighter-rouge">function</code>.</p> <p>Sintaxe básica:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function NomeDaFuncao {
    # Comandos
}
</code></pre></div></div> <p>Exemplo:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function Saudacao {
    Write-Output "Olá, bem-vindo ao script!"
}
</code></pre></div></div> <p>Para executar:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Saudacao
</code></pre></div></div> <p><strong>Nota sobre o scope das funções:</strong></p> <ul> <li>Se criares uma função <strong>no terminal</strong>, ela só estará disponível enquanto essa sessão estiver aberta.</li> <li>Se definires uma função <strong>dentro de um script</strong>, ela só pode ser usada dentro desse mesmo script, durante a sua execução.</li> <li>Para tornares uma função disponível em qualquer terminal, coloca-a no ficheiro <code class="language-plaintext highlighter-rouge">$PROFILE</code>.</li> </ul> <h3 id="42-funções-com-parâmetros"> <a href="#42-funções-com-parâmetros" class="anchor-heading" aria-labelledby="42-funções-com-parâmetros"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4.2. Funções com parâmetros </h3> <p>Podes passar valores para uma função usando <code class="language-plaintext highlighter-rouge">param()</code>.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function SaudacaoPersonalizada {
    param($nome)

    Write-Output "Olá, $nome! Bem-vindo."
}
</code></pre></div></div> <p>Para correr:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SaudacaoPersonalizada -nome "Rita"
</code></pre></div></div> <p>Podes também definir mais do que um parâmetro:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function Soma {
    param($a, $b)
    
    $resultado = $a + $b
    Write-Output "Resultado: $resultado"
}
</code></pre></div></div> <p>Para correr:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Soma -a 5 -b 3
</code></pre></div></div> <h3 id="43-tipagem-de-parâmetros-opcional"> <a href="#43-tipagem-de-parâmetros-opcional" class="anchor-heading" aria-labelledby="43-tipagem-de-parâmetros-opcional"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4.3. Tipagem de parâmetros (opcional) </h3> <p>Podes indicar que esperas um tipo específico de valor (ex: string, int, etc.)</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function Dobro {
    param([int]$numero)

    return $numero * 2
}
</code></pre></div></div> <p>Para correr:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Dobro -numero 4
</code></pre></div></div> <h3 id="44-funções-para-modularizar-scripts"> <a href="#44-funções-para-modularizar-scripts" class="anchor-heading" aria-labelledby="44-funções-para-modularizar-scripts"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4.4. Funções para modularizar scripts </h3> <p>Se tens scripts com várias partes repetidas (como logging, validação de inputs, confirmação), podes colocá-las em funções.</p> <p>Exemplo: função para confirmar uma ação</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function Confirmar-Acao {
    param($mensagem)

    $resposta = Read-Host "$mensagem (S/N)"
    if ($resposta -ne "N") {
        Write-Output "Operação cancelada."
        return $false
    }
    return $true
}
</code></pre></div></div> <p>Para utilizar:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>if (-not (Confirmar-Acao "Queres apagar este ficheiro?")) {
    return
}
</code></pre></div></div> <h3 id="45-usar-return-para-devolver-valores"> <a href="#45-usar-return-para-devolver-valores" class="anchor-heading" aria-labelledby="45-usar-return-para-devolver-valores"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4.5. Usar <code class="language-plaintext highlighter-rouge">return</code> para devolver valores </h3> <p>Podes usar <code class="language-plaintext highlighter-rouge">return</code> numa função para devolver um valor, tal como noutras linguagens.</p> <h4 id="exemplo-simples"> <a href="#exemplo-simples" class="anchor-heading" aria-labelledby="exemplo-simples"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Exemplo simples: </h4> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function Triplo {
    param([int]$numero)
    return $numero * 3
}

$resultado = Triplo -numero 4
Write-Output "Triplo: $resultado"
</code></pre></div></div> <h4 id="diferença-entre-write-output-e-return"> <a href="#diferença-entre-write-output-e-return" class="anchor-heading" aria-labelledby="diferença-entre-write-output-e-return"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Diferença entre <code class="language-plaintext highlighter-rouge">Write-Output</code> e <code class="language-plaintext highlighter-rouge">return</code> </h4> <ul> <li><code class="language-plaintext highlighter-rouge">Write-Output</code> envia o valor para o <strong>stream de saída (output)</strong> do PowerShell, normalmente visível no terminal.</li> <li><code class="language-plaintext highlighter-rouge">return</code> termina a função imediatamente e devolve o valor para ser usado <strong>noutro contexto</strong>, como numa variável, num <code class="language-plaintext highlighter-rouge">if</code>, ou noutra função.</li> </ul> <p>Em muitos casos, <strong>ambos os comandos parecem funcionar da mesma forma</strong>, mas o <code class="language-plaintext highlighter-rouge">return</code> é preferido quando queremos usar o valor <strong>de forma controlada</strong>, sem poluir a saída do script.</p> <p><strong>Exemplo 1</strong> – usar <code class="language-plaintext highlighter-rouge">return</code> para cálculo:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function Soma {
    param($x, $y)
    return $x + $y
}

$total = Soma -x 5 -y 7
if ($total -gt 10) {
    Write-Output "Resultado maior que 10"
}
</code></pre></div></div> <p><strong>Exemplo 2</strong> – usar <code class="language-plaintext highlighter-rouge">Write-Output</code> envia para o pipeline (terminal):</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function Soma {
    param($x, $y)
    Write-Output ($x + $y)
}

# Este também funciona:
$total = Soma -x 5 -y 7
</code></pre></div></div> <p><strong>Recomendação:</strong> Usa <code class="language-plaintext highlighter-rouge">return</code> quando quiseres <strong>devolver valores para serem usados noutros blocos de código</strong>.<br /> Usa <code class="language-plaintext highlighter-rouge">Write-Output</code> quando quiseres <strong>mostrar informação no terminal</strong> (mensagens, instruções, etc.).</p> <h4 id="podes-devolver-texto-números-arrays-objetos"> <a href="#podes-devolver-texto-números-arrays-objetos" class="anchor-heading" aria-labelledby="podes-devolver-texto-números-arrays-objetos"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Podes devolver texto, números, arrays, objetos… </h4> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function Lista-Extensoes {
    return @("txt", "csv", "log")
}

$extensoes = Lista-Extensoes
$extensoes | ForEach-Object { Write-Output "Tipo: $_" }
</code></pre></div></div> <blockquote> <p>Se não usares <code class="language-plaintext highlighter-rouge">return</code>, o PowerShell devolve implicitamente o último valor calculado.</p> </blockquote> <h3 id="46-boas-práticas-ao-criar-funções"> <a href="#46-boas-práticas-ao-criar-funções" class="anchor-heading" aria-labelledby="46-boas-práticas-ao-criar-funções"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4.6. Boas práticas ao criar funções </h3> <ul> <li>O nome da função deve indicar claramente o que faz</li> <li>Usa verbos no infinitivo (ex: <code class="language-plaintext highlighter-rouge">Mostrar-Mensagem</code>, <code class="language-plaintext highlighter-rouge">Copiar-Ficheiro</code>, <code class="language-plaintext highlighter-rouge">Validar-Input</code>)</li> <li>Usa <code class="language-plaintext highlighter-rouge">return</code> quando quiseres devolver valores</li> <li>Escreve funções pequenas e com um propósito claro</li> <li>Testa individualmente cada função antes de a integrar num script</li> </ul> <blockquote> <p>Se quiseres que a tua função tenha ajuda acessível com <code class="language-plaintext highlighter-rouge">Get-Help</code>, podes adicionar um bloco de comentário estruturado antes da função. Vamos ver um exemplo completo mais à frente, na secção sobre personalização com <code class="language-plaintext highlighter-rouge">$PROFILE</code>.</p> </blockquote><hr /> <h3 id="47-verbos-aprovados-pelo-powershell"> <a href="#47-verbos-aprovados-pelo-powershell" class="anchor-heading" aria-labelledby="47-verbos-aprovados-pelo-powershell"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4.7. Verbos aprovados pelo PowerShell </h3> <p>Para manter os teus scripts consistentes com os módulos oficiais, deves usar <strong>verbos padronizados</strong> nos nomes das funções, como <code class="language-plaintext highlighter-rouge">Get</code>, <code class="language-plaintext highlighter-rouge">Set</code>, <code class="language-plaintext highlighter-rouge">New</code>, <code class="language-plaintext highlighter-rouge">Remove</code>, etc.</p> <p>Estes verbos fazem parte da lista de <strong>verbos aprovados pelo PowerShell</strong>, recomendados pela Microsoft.</p> <h4 id="exemplos-de-bons-nomes-de-funções"> <a href="#exemplos-de-bons-nomes-de-funções" class="anchor-heading" aria-labelledby="exemplos-de-bons-nomes-de-funções"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Exemplos de bons nomes de funções: </h4> <ul> <li><code class="language-plaintext highlighter-rouge">Get-Relatorio</code></li> <li><code class="language-plaintext highlighter-rouge">New-Backup</code></li> <li><code class="language-plaintext highlighter-rouge">Remove-FicheirosAntigos</code></li> <li><code class="language-plaintext highlighter-rouge">Set-Configuracao</code></li> <li><code class="language-plaintext highlighter-rouge">Test-Login</code></li> </ul> <h4 id="como-ver-a-lista-de-verbos-aprovados"> <a href="#como-ver-a-lista-de-verbos-aprovados" class="anchor-heading" aria-labelledby="como-ver-a-lista-de-verbos-aprovados"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Como ver a lista de verbos aprovados: </h4> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-Verb
</code></pre></div></div> <p>Este comando mostra todos os verbos oficialmente aceites.</p> <blockquote> <p>⚠️ Evita usar verbos inventados como <code class="language-plaintext highlighter-rouge">Executar-</code>, <code class="language-plaintext highlighter-rouge">Atualiza-</code>, <code class="language-plaintext highlighter-rouge">Ler-Valor</code>, etc.<br /> Usa verbos padronizados para facilitar leitura, intellisense e integração futura em módulos.</p> </blockquote><hr /> <h3 id="48--exercícios-com-funções"> <a href="#48--exercícios-com-funções" class="anchor-heading" aria-labelledby="48--exercícios-com-funções"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4.8. 🧩 Exercícios com funções </h3> <p><strong>Exercício 1 – Converter temperatura</strong></p> <p>Cria uma função chamada <code class="language-plaintext highlighter-rouge">Converter-CelsiusParaFahrenheit</code> que:</p> <ul> <li>Recebe uma temperatura em Celsius como parâmetro</li> <li>Converte para Fahrenheit usando a fórmula: F = C × 1.8 + 32</li> <li>Devolve o valor convertido</li> </ul> <p>Depois de criar a função, chama-a com um valor (por exemplo, 25) e mostra o resultado no terminal.</p> <!-- <details markdown="1"> <summary>Solução – Exercício 1</summary> function Converter-CelsiusParaFahrenheit { param([double]$celsius) return $celsius * 1.8 + 32 } $resultado = Converter-CelsiusParaFahrenheit -celsius 25 Write-Output "Temperatura em Fahrenheit: $resultado" </details> --> <p><strong>Exercício 2 – Verificar se número é par</strong></p> <p>Cria uma função chamada <code class="language-plaintext highlighter-rouge">EhPar</code> que:</p> <ul> <li>Recebe um número como parâmetro</li> <li>Devolve <code class="language-plaintext highlighter-rouge">True</code> se for par, <code class="language-plaintext highlighter-rouge">False</code> caso contrário</li> </ul> <!-- <details markdown="1"> <summary>Solução – Exercício 2</summary> function EhPar { param([int]$numero) return ($numero % 2 -eq 0) } if (EhPar -numero 4) { Write-Output "É par" } else { Write-Output "É ímpar" } </details> --> <p><strong>Exercício 3 – Calcular total de ficheiros</strong></p> <p>Cria uma função <code class="language-plaintext highlighter-rouge">Contar-Ficheiros</code> que:</p> <ul> <li>Recebe uma pasta como parâmetro</li> <li>Conta e devolve o número de ficheiros existentes nessa pasta</li> </ul> <!-- <details markdown="1"> <summary>Ssolução – Exercício 3</summary> function Contar-Ficheiros { param([string]$pasta) if (-not (Test-Path $pasta)) { Write-Output "Pasta não encontrada: $pasta" return 0 } $ficheiros = Get-ChildItem -Path $pasta -File return $ficheiros.Count } $pasta = Read-Host "Introduz o caminho da pasta" $total = Contar-Ficheiros -pasta $pasta Write-Output "Total de ficheiros: $total" </details> --><hr /> <h2 id="5-recolha-de-inputs-do-utilizador"> <a href="#5-recolha-de-inputs-do-utilizador" class="anchor-heading" aria-labelledby="5-recolha-de-inputs-do-utilizador"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5. Recolha de Inputs do Utilizador </h2> <p>Scripts mais interativos recolhem informação diretamente do utilizador. Já usámos <code class="language-plaintext highlighter-rouge">Read-Host</code> em exemplos anteriores — agora vamos reforçar e expandir com novas formas de entrada, validação e segurança.</p> <blockquote> <p>🔗 Relembrar: <code class="language-plaintext highlighter-rouge">Read-Host</code> foi introduzido na <a href="../Module2/session5#41-pedir-input-ao-utilizador-read-host">Sessão 5 do Módulo 2</a></p> </blockquote> <h3 id="51-recolher-input-com-read-host"> <a href="#51-recolher-input-com-read-host" class="anchor-heading" aria-labelledby="51-recolher-input-com-read-host"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5.1. Recolher input com <code class="language-plaintext highlighter-rouge">Read-Host</code> </h3> <p><code class="language-plaintext highlighter-rouge">Read-Host</code> permite obter um valor simples do utilizador como string:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$nome = Read-Host "Qual é o teu nome?"
Write-Output "Olá, $nome!"
</code></pre></div></div> <p>Todos os valores recolhidos com <code class="language-plaintext highlighter-rouge">Read-Host</code> são tratados inicialmente como texto (<code class="language-plaintext highlighter-rouge">[string]</code>).</p> <h3 id="52-converter-e-validar-o-input"> <a href="#52-converter-e-validar-o-input" class="anchor-heading" aria-labelledby="52-converter-e-validar-o-input"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5.2. Converter e validar o input </h3> <p>Podes forçar a conversão para outros tipos (como <code class="language-plaintext highlighter-rouge">[int]</code>) ou validar com condições:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$idade = Read-Host "Qual é a tua idade?"
if ($idade -match '^\d+$') {
    Write-Output "Tens $idade anos"
} else {
    Write-Output "Idade inválida."
}
</code></pre></div></div> <p>Outra forma:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>try {
    $numero = [int](Read-Host "Introduz um número inteiro")
    Write-Output "Número válido: $numero"
} catch {
    Write-Output "Valor inválido!"
}
</code></pre></div></div> <h3 id="53-confirmar-ações-com-input"> <a href="#53-confirmar-ações-com-input" class="anchor-heading" aria-labelledby="53-confirmar-ações-com-input"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5.3. Confirmar ações com input </h3> <p>Antes de executar ações importantes, como apagar ou modificar ficheiros, pede confirmação:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$confirma = Read-Host "Tens a certeza que queres continuar? (S/N)"
if ($confirma -ne "S") {
    Write-Output "Operação cancelada."
    return
}
</code></pre></div></div> <h3 id="54-input-com-janela-gráfica"> <a href="#54-input-com-janela-gráfica" class="anchor-heading" aria-labelledby="54-input-com-janela-gráfica"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5.4. Input com janela gráfica </h3> <p>PowerShell permite criar caixas de input com janelas (útil em scripts mais amigáveis):</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Add-Type -AssemblyName Microsoft.VisualBasic
$valor = [Microsoft.VisualBasic.Interaction]::InputBox("Introduz o teu nome", "Nome")
Write-Output "Olá, $valor!"
</code></pre></div></div> <p>Não requer instalação adicional, funciona no Windows com interface gráfica.</p> <p><strong>Explicação rápida do exemplo com InputBox:</strong> Linha 1: <code class="language-plaintext highlighter-rouge">Add-Type -AssemblyName Microsoft.VisualBasic</code><br /> Carrega uma biblioteca que permite usar janelas gráficas simples no PowerShell.</p> <p>Linha 2: <code class="language-plaintext highlighter-rouge">$valor = [Microsoft.VisualBasic.Interaction]::InputBox("Introduz o teu nome", "Nome")</code><br /> Mostra uma caixa de input com o texto “Introduz o teu nome” e o título “Nome”.<br /> O valor introduzido é guardado na variável <code class="language-plaintext highlighter-rouge">$valor</code>.</p><hr /> <h3 id="55-sanitização-e-boas-práticas"> <a href="#55-sanitização-e-boas-práticas" class="anchor-heading" aria-labelledby="55-sanitização-e-boas-práticas"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5.5. Sanitização e boas práticas </h3> <ul> <li>Verifica sempre se o input é válido <strong>antes de usar</strong></li> <li>Evita inputs perigosos em comandos (<code class="language-plaintext highlighter-rouge">Remove-Item $input</code> sem validar pode ser arriscado)</li> <li>Usa regex ou validação com <code class="language-plaintext highlighter-rouge">[int]</code>, <code class="language-plaintext highlighter-rouge">[datetime]</code>, etc.</li> <li>Dá feedback claro ao utilizador</li> </ul> <h3 id="56-exemplo-sem-sanitização-vs-com-sanitização-simples-e-seguro"> <a href="#56-exemplo-sem-sanitização-vs-com-sanitização-simples-e-seguro" class="anchor-heading" aria-labelledby="56-exemplo-sem-sanitização-vs-com-sanitização-simples-e-seguro"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5.6. Exemplo: sem sanitização vs com sanitização (simples e seguro) </h3> <h4 id="sem-sanitização"> <a href="#sem-sanitização" class="anchor-heading" aria-labelledby="sem-sanitização"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Sem sanitização </h4> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$opcao = Read-Host "Escolhe uma opção (1 = Ver lista, 2 = Sair)"

if ($opcao -eq 1) {
    Write-Output "Lista de produtos: ..."
} elseif ($opcao -eq 2) {
    Write-Output "A sair..."
} else {
    Write-Output "Opção inválida"
}
</code></pre></div></div> <blockquote> <p>Se o utilizador escrever <code class="language-plaintext highlighter-rouge">1; Remove-Item *</code>, o PowerShell pode interpretar como dois comandos separados (em certos contextos ou se o input for passado sem validação para outra função).</p> <p>Também aceita inputs como <code class="language-plaintext highlighter-rouge">abc</code>, <code class="language-plaintext highlighter-rouge">dois</code>, ou espaços — e o script responde com “Opção inválida”, mas o código ainda processa a string, o que pode ser arriscado se usado noutra função.</p> </blockquote><hr /> <h4 id="com-sanitização"> <a href="#com-sanitização" class="anchor-heading" aria-labelledby="com-sanitização"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Com sanitização </h4> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$opcao = Read-Host "Escolhe uma opção (1 = Ver lista, 2 = Sair)"

if ($opcao -match '^[12]$') {
    if ($opcao -eq '1') {
        Write-Output "Lista de produtos: ..."
    } else {
        Write-Output "A sair..."
    }
} else {
    Write-Output "Opção inválida. Introduz apenas 1 ou 2."
}
</code></pre></div></div> <blockquote> <p>Aqui só são aceites os valores <code class="language-plaintext highlighter-rouge">1</code> ou <code class="language-plaintext highlighter-rouge">2</code>. Tudo o resto é bloqueado à partida.</p> </blockquote><hr /> <h3 id="57--exercícios-sobre-input"> <a href="#57--exercícios-sobre-input" class="anchor-heading" aria-labelledby="57--exercícios-sobre-input"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5.7. 🧩 Exercícios sobre Input </h3> <p><strong>Exercício 1 – Validar número com repetição</strong></p> <ul> <li>Pede um número ao utilizador</li> <li>Enquanto o valor não for um número inteiro, mostra erro e volta a pedir</li> <li>Quando for um número válido, verifica se é par ou ímpar</li> </ul> <!-- <details markdown="1"> <summary>Solução – Exercício 1: Validar número com repetição</summary> $input = Read-Host "Introduz um número inteiro" while ($input -notmatch '^\d+$') { Write-Output "Valor inválido. Introduz apenas números inteiros." $input = Read-Host "Introduz um número inteiro" } $numero = [int]$input if ($numero % 2 -eq 0) { Write-Output "O número $numero é par." } else { Write-Output "O número $numero é ímpar." } </details> --> <p><strong>Exercício 2 – Validação de data</strong></p> <ul> <li>Pede ao utilizador uma data no formato “dd/MM/yyyy”</li> <li>Valida se o input é uma data válida usando <code class="language-plaintext highlighter-rouge">[datetime]</code></li> <li>Se for válida, mostra a data no formato longo (ex: “segunda-feira, 20 de maio de 2024”)</li> <li>Caso contrário, mostra mensagem de erro</li> </ul> <!-- <details markdown="1"> <summary>Solução – Exercício 2: Validação de data</summary> # Pedir data no formato português $dataTexto = Read-Host "Introduz uma data (dd/MM/yyyy)" # Tentar converter para datetime try { $data = [datetime]::ParseExact($dataTexto, "dd/MM/yyyy", $null) Write-Output "Data válida: $($data.ToString('D'))" } catch { Write-Output "Data inválida. Usa o formato dd/MM/yyyy." } </details> --> <p><strong>Exercício 3 – Usar InputBox</strong></p> <ul> <li>Mostra uma InputBox com a pergunta “Qual o teu nome?”</li> <li>Mostra uma saudação personalizada no terminal</li> </ul> <!-- <details markdown="1"> <summary>📌 Exemplo de solução – Exercício 3: Usar InputBox</summary> # Carregar biblioteca para usar InputBox Add-Type -AssemblyName Microsoft.VisualBasic # Mostrar caixa de input e guardar valor $nome = [Microsoft.VisualBasic.Interaction]::InputBox("Qual o teu nome?", "Pergunta") # Mostrar saudação no terminal Write-Output "Olá, $nome! Bem-vindo ao PowerShell." </details> --><hr /> </main> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
